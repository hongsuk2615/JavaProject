<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>게시판 CRUD 예제</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet">
    <script th:src="@{/js/common.js}"></script>
</head>
<body>
<div class="sidebar">
    <a th:href="@{/}"><h2>Tech Stack</h2></a>
    <ul>
        <li><a th:href="@{/crud}">CRUD</a></li>
        <li><a th:href="@{/auth}">Auth (JWT + OAuth2)</a></li>
        <li><a th:href="@{/kafka}">Kafka</a></li>
        <li><a th:href="@{/ci}">CI/CD</a></li>
    </ul>
</div>
<div class="content">
    <h1 class="text-center mb-4">CRUD 데모</h1>
    <div class="text-end mb-3">
        <a href="/crud/board/write" class="btn btn-primary">글 작성하기</a>
    </div>

    <table class="table table-hover text-center align-middle">
        <thead>
        <tr>
            <th>#</th>
            <th>제목</th>
            <th>작성자</th>
            <th>작성일</th>
        </tr>
        </thead>
        <tbody id="board-body">
        </tbody>
    </table>

</div>
</body>
<script>
    async function loadBoards() {
        try {
            const response = await fetch('/api/board'); // REST API 호출
            const boards = await response.json();

            const tbody = document.getElementById('board-body');
            tbody.innerHTML = '';

            boards.forEach(board => {
                const tr = document.createElement('tr');

                const authorCell = document.createElement('td');
                authorCell.appendChild(createAuthorElement(board.authorEmail, board.authorProvider));

                tr.innerHTML = `
                    <td>${board.id}</td>
                    <td class="post-title" onclick="window.location.href='/crud/board/content/${board.id}'">${board.title}</td>
                    <td></td>
                    <td>${new Date(board.createdAt).toLocaleString()}</td>
                `;

                // 작성자 셀 교체
                tr.children[2].replaceWith(authorCell);

                tbody.appendChild(tr);
            });
        } catch (err) {
            console.error('게시판 로드 실패', err);
        }
    }
    // 초기 로드
    loadBoards();
</script>
</html>
