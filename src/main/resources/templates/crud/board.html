<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>게시판 CRUD 예제</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet">
</head>
<body>
<div class="sidebar">
    <a th:href="@{/}"><h2>Tech Stack</h2></a>
    <ul>
        <li><a th:href="@{/crud}">CRUD</a></li>
        <li><a th:href="@{/auth}">Auth (JWT + OAuth2)</a></li>
        <li><a th:href="@{/kafka}">Kafka</a></li>
        <li><a th:href="@{/ci}">CI/CD</a></li>
    </ul>
</div>
<div class="content">
    <h1 class="text-center mb-4">CRUD 데모</h1>
    <div class="text-end mb-3">
        <a href="/crud/board/write" class="btn btn-primary">글 작성하기</a>
    </div>

    <table class="table table-hover text-center align-middle">
        <thead>
        <tr>
            <th>#</th>
            <th>제목</th>
            <th>작성자</th>
            <th>작성일</th>
            <th>관리</th>
        </tr>
        </thead>
        <tbody id="board-body">
        </tbody>
    </table>

</div>
</body>
<script>
    async function loadPosts() {
        try {
            const response = await fetch('/api/board'); // REST API 호출
            const posts = await response.json();

            const tbody = document.getElementById('board-body');
            tbody.innerHTML = '';

            posts.forEach(post => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${post.id}</td>
                    <td onclick="window.location.href = \`/crud/board/content/${post.id}\`">${post.title}</td>
                    <td>${post.authorEmail}</td>
                    <td>${new Date(post.createdAt).toLocaleString()}</td>
                    <td>
                        <button class="btn btn-outline-light btn-sm" onclick="editBoard(${post.id})">수정</button>
                        <button class="btn btn-outline-light btn-sm" onclick="deleteBoard(${post.id})">삭제</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        } catch (err) {
            console.error('게시판 로드 실패', err);
        }
    }

    function editPost(id) {
        window.location.href = `/crud/board/edit/${id}`;
    }



    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }

    // 초기 로드
    loadPosts();
</script>
</html>
